// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}

enum SaleStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model User {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  email     String   @unique @db.VarChar(100)
  password  String   @db.VarChar(255)
  name      String   @db.VarChar(50)

  @@map("user")
}

model Client {
  id          Int           @id @default(autoincrement())
  name        String        @db.VarChar(50)
  surname     String        @db.VarChar(50)
  dni         String        @unique @db.VarChar(8)
  phoneNumber String        @unique @map("phone_number") @db.VarChar(20)
  email       String        @unique @db.VarChar(100)
  sales       Sale[]
  addresses   BillAddress[]

  @@map("client_info")
}

model BillAddress {
  id        Int     @id @default(autoincrement())
  street    String  @db.VarChar(100)
  streetNum Int     @map("street_num")
  floor     Int?
  apartment String? @db.VarChar(10)
  locality  String  @db.VarChar(100)
  province  String  @db.VarChar(100)
  reference String? @db.VarChar(255)

  clientId Int    @map("client_id")
  client   Client @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("bill_address")
}

model Category {
  id            Int           @id @default(autoincrement())
  name          String        @unique @map("category_name") @db.VarChar(100)
  createdAt     DateTime      @default(now()) @map("created_at")
  status        Boolean       @default(true)
  subCategories SubCategory[]

  @@map("categories")
}

model SubCategory {
  id        Int      @id @default(autoincrement())
  name      String   @unique @map("subcategory_name") @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at")
  status    Boolean  @default(true)

  categoryId Int      @map("categories_id")
  category   Category @relation(fields: [categoryId], references: [id])

  brands   Brand[] // Cada subcategoría puede tener varias marcas
  products Product[] // Productos asociados a esta subcategoría

  @@map("subcategories")
}

model Brand {
  id        Int      @id @default(autoincrement())
  name      String   @unique @map("marca_name") @db.VarChar(100)
  createdAt DateTime @default(now()) @map("created_at")
  status    Boolean  @default(true)

  subCategoryId Int         @map("sub_categories_id") // Marca pertenece a una subcategoría
  subCategory   SubCategory @relation(fields: [subCategoryId], references: [id])

  products Product[]

  @@map("brand")
}

model Sale {
  id        Int        @id @default(autoincrement())
  createdAt DateTime   @default(now()) @map("created_at")
  status    SaleStatus @default(PENDING)

  clientId Int    @map("client_id")
  client   Client @relation(fields: [clientId], references: [id])

  details SaleDetails[]

  @@map("sale")
}

model SaleDetails {
  id Int @id @default(autoincrement())

  saleId    Int @map("sale_id")
  productId Int @map("product_id")

  quantity     Int
  unitaryPrice Decimal @map("unitary_price")

  sale    Sale    @relation(fields: [saleId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id])

  @@unique([saleId, productId])
  @@map("sale_details")
}

model Product {
  id               Int      @id @default(autoincrement())
  name             String   @db.VarChar(100)
  description      String   @db.VarChar(500)
  unit             String   @db.VarChar(50)
  price            Decimal  @db.Decimal(12, 2)
  status           Boolean  @default(true)
  createdAt        DateTime @default(now()) @map("created_at")
  imageUrl         String   @map("img") @db.VarChar(255)
  stock            Int
  showingInCatalog Boolean  @default(false) @map("showing_in_catalog")

  subCategoryId Int         @map("sub_categories_id")
  subCategory   SubCategory @relation(fields: [subCategoryId], references: [id])

  brandId Int   @map("brand_id")
  brand   Brand @relation(fields: [brandId], references: [id])

  saleDetails SaleDetails[]

  @@map("products")
}
